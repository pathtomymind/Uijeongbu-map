<!DOCTYPE html>
<html>
<head>
    <title>의정부 정비 경로 (실시간 업데이트)</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <style>
        #map { height: 100vh; width: 100%; background: #eee; }
        body { margin: 0; padding: 0; }
        .transparent-label {
            background: transparent !important; border: none !important; box-shadow: none !important;
            font-size: 13px; font-weight: 900; color: #d63031;
            text-shadow: -1.2px -1.2px 0 #fff, 1.2px -1.2px 0 #fff, -1.2px 1.2px 0 #fff, 1.2px 1.2px 0 #fff;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-ant-path@1.3.0/dist/leaflet-ant-path.min.js"></script>

    <script>
        var map = L.map('map');
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // data.json 파일을 불러오는 함수
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                var points = data.points;
                var latlngs = points.map(p => L.latLng(p.lat, p.lng));
                
                map.fitBounds(L.latLngBounds(latlngs), { padding: [50, 50] });

                points.forEach(function(p, i) {
                    if (i === points.length - 1 && i !== 0) return;
                    L.marker([p.lat, p.lng]).addTo(map)
                        .bindTooltip(p.name, { 
                            permanent: true, direction: 'right', 
                            className: 'transparent-label', offset: [12, 0] 
                        });
                });

                var control = L.Routing.control({
                    waypoints: latlngs,
                    createMarker: function() { return null; },
                    show: false,
                    router: L.Routing.osrmv1({ serviceUrl: 'https://routing.openstreetmap.de/routed-car/route/v1' }),
                    lineOptions: { styles: [{ opacity: 0 }] }
                }).addTo(map);

                control.on('routesfound', function(e) {
                    L.polyline.antPath(e.routes[0].coordinates, {
                        delay: 1000, dashArray: [2, 10], weight: 4, color: "#1e3799", pulseColor: "#ffffff"
                    }).addTo(map);
                });
            })
            .catch(error => console.error('데이터를 불러오지 못했습니다:', error));
    </script>
</body>
</html>
