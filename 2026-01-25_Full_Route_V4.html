<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026-01-25 정비 경로 가독성 개선 버전 (V4)</title>
    <meta property="og:title" content="2026-01-25 정비 경로 가독성 개선 버전">
    <meta property="og:description" content="말풍선 겹침 해결 및 실제 도로망 기반의 최적화 정비 동선입니다.">
    <meta property="og:type" content="website">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; }
        #map { height: 100vh; width: 100vw; }
        .leaflet-routing-container { display: none !important; }
        .custom-tooltip {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #764ba2;
            border-radius: 6px;
            font-weight: bold;
            padding: 4px 8px;
            color: #333;
            font-size: 11px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<script>
    // 도로 진입로 및 로컬 도로 우선을 위한 정밀 보정 좌표
    const points = [
        {lat: 37.7501, lng: 127.0331, name: "1. 의정부시청 (출발)"},
        {lat: 37.7455, lng: 127.0495, name: "2. 태평로 132 (화순식당)"},
        {lat: 37.7512, lng: 127.0985, name: "3. 민락동 910"},
        {lat: 37.7395, lng: 127.1065, name: "4. 고산동 874 (휴스토리)"}, // 로컬 도로 보정
        {lat: 37.7335, lng: 127.1110, name: "5. 수암로 25 (산곡동 730)"}, // 우회 방지 보정
        {lat: 37.7285, lng: 127.1085, name: "6. 산곡동 810 삼거리"},
        {lat: 37.7585, lng: 127.0425, name: "7. 가능동 205-1"},
        {lat: 37.7665, lng: 127.0385, name: "8. 가금교 삼거리"},
        {lat: 37.7542, lng: 127.0371, name: "9. 가능동 663-9"},
        {lat: 37.7538, lng: 127.0365, name: "10. 가능동 663-21"},
        {lat: 37.7501, lng: 127.0331, name: "11. 의정부시청 (복귀)"}
    ];

    const map = L.map('map', { zoomControl: false }).setView([37.745, 127.07], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // 마커 및 겹침 방지 툴팁 로직
    points.forEach((pt, index) => {
        let color = (index === 0) ? "#28a745" : (index === points.length - 1) ? "#fd7e14" : "#4A90E2";
        
        // 1번 출발과 마지막 복귀 지점의 툴팁 방향을 상하로 분리하여 겹침 방지
        let tooltipDir = (index === 0) ? "top" : (index === points.length - 1) ? "bottom" : "right";
        let tooltipOffset = (index === 0) ? [0, -10] : (index === points.length - 1) ? [0, 10] : [12, 0];

        const marker = L.circleMarker([pt.lat, pt.lng], {
            radius: 8, fillColor: color, color: "#fff", weight: 2, fillOpacity: 1
        }).addTo(map);

        marker.bindTooltip(pt.name, {
            permanent: true,
            direction: tooltipDir,
            offset: tooltipOffset,
            className: 'custom-tooltip'
        });
    });

    // 정비 구간: 파란색 실선 (실제 도로망 기반)
    L.Routing.control({
        waypoints: points.slice(0, 10).map(p => L.latLng(p.lat, p.lng)),
        lineOptions: { styles: [{ color: '#007bff', opacity: 0.8, weight: 6 }] },
        createMarker: () => null,
        addWaypoints: false,
        draggableWaypoints: false,
        fitSelectedRoutes: true
    }).addTo(map);

    // 복귀 구간: 빨간색 점선 (실제 도로망 기반)
    L.Routing.control({
        waypoints: [L.latLng(points[9].lat, points[9].lng), L.latLng(points[10].lat, points[10].lng)],
        lineOptions: { styles: [{ color: '#dc3545', opacity: 0.7, weight: 6, dashArray: '10, 10' }] },
        createMarker: () => null,
        addWaypoints: false,
        draggableWaypoints: false
    }).addTo(map);
</script>
</body>
</html>
